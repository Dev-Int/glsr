{% if edit_form is defined %}
    {% set form = edit_form %}
    {{ form_start(form) }}
{% else %}
    {{ form_start(form, {action: path('articles_create')}) }}
{% endif %}

    <fieldset class="well">
        {{ form_errors(form) }}
        <legend>{{ 'form.info'|trans({}, 'gs_articles') }}</legend>
        <section class="form-line">
            <div class="col-md-1 label label-default">
                {{ form_label(form.name) }}
            </div>
            <div class="col-md-5">
                <span class="text-danger">{{ form_errors(form.name) }}</span>
                {{ form_widget(form.name) }}
            </div>
            <div class="col-md-1 label label-default">
                {{ form_label(form.supplier) }}
            </div>
            <div class="col-md-5">
                <span class="text-danger">{{ form_errors(form.supplier) }}</span>
                {{ form_widget(form.supplier, { 'attr' : { 'onChange':'getFamilyLog();' } }) }}
            </div>
            <div class="clear"></div>
        </section>
        <section class="form-line">
            <div class="col-md-4">
                <span class="text-danger">{{ form_errors(form.zone_storages) }}</span>
                {% block choice_widget_expanded %}
                    {% spaceless %}
                    <div {{ block('widget_container_attributes') }}>
                        <table class="panel panel-default">
                            <thead class="page-header label label-default">
                                <tr>
                                    <th colspan="2">
                                        <i class="fa fa-map-marker"></i>&nbsp;
                                        {{ form_label(form.zone_storages) }}</th></tr>
                            </thead>
                            <tbody class="panel-body">
                                {% for child in form.zone_storages %}
                                    <tr>
                                        <td class="col-md-1 text-center">{{ form_widget(child) }}</td>
                                        <td class="col-md-2">{{ form_label(child) }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endspaceless %}
                {% endblock choice_widget_expanded %}
                {{ form_widget(form.zone_storages) }}
            </div>
            <div class="col-md-2 col-md-offset-1 label label-default">
                <i class="fa fa-tags"></i>&nbsp;
                {{ form_label(form.family_log) }}
            </div>
            <div class="col-md-5">
                <span class="text-danger">{{ form_errors(form.family_log) }}</span>
                {{ form_widget(form.family_log) }}
                <input id="hidden_flog" name="article[family_log]" type="hidden" value="" />
            </div>
            <div class="clear"></div>
        </section>
    </fieldset>
    <fieldset class="well"><legend>{{ 'settings.feature'|trans({}, 'gs_articles') }}</legend>
        <section class="form-line">
            <div class="col-md-2 label label-default">
                <i class="fa fa-cubes"></i>&nbsp;
                {{ form_label(form.unit_storage) }}
            </div>
            <div class="col-md-4">
                <span class="text-danger">{{ form_errors(form.unit_storage) }}</span>
                {{ form_widget(form.unit_storage) }}
            </div>
            <div class="col-md-1 label label-default">
                {{ form_label(form.price) }}
            </div>
            <div class="col-md-5">
                <span class="text-danger">{{ form_errors(form.price) }}</span>
                {{ form_widget(form.price) }}
            </div>
            <div class="clear"></div>
        </section>
        <section class="form-line">
           <div class="col-md-2 label label-default">
                {{ form_label(form.packaging) }}
            </div>
            <div class="col-md-4">
                <span class="text-danger">{{ form_errors(form.packaging) }}</span>
                {{ form_widget(form.packaging) }}
            </div>
           <div class="col-md-1 label label-default">
                {{ form_label(form.minstock) }}
            </div>
            <div class="col-md-5">
                <span class="text-danger">{{ form_errors(form.minstock) }}</span>
                {{ form_widget(form.minstock) }}
            </div>
            <div class="clear"></div>
        </section>
    </fieldset>

    <p>
        <button class="btn btn-primary" type="submit">
            {% if edit_form is defined %}
                <i class="fa fa-edit"></i>&nbsp;
                {{ 'Edit'|trans({}, 'admin') }}
            {% else %}
                <i class="fa fa-plus"></i>&nbsp;
                {{ 'Create'|trans({}, 'admin') }}
            {% endif %}
        </button>
    </p>
{{ form_end(form) }}

<script type="text/javascript">
function getFamilyLog(){
    var id_select = $('#article_supplier').val();
    $.ajax({
        url: "{{ path('getfamilylog') }}",
        type: 'POST',
        data: {'id': id_select},
        dataType: 'json',
        success: function(json){
            $('#article_family_log option:selected').removeAttr('selected');
            $('#article_family_log option[value="' + json.familylog + '"').attr('selected', 'selected');
            $('#article_family_log').prop('disabled', true);
            $('#hidden_flog').val( json.familylog );
        }
    });
}
</script>
